{"componentChunkName":"component---src-templates-post-js","path":"/Operations/23-12-18/","result":{"data":{"markdownRemark":{"html":"<h3 id=\"taskgroups\" style=\"position:relative;\"><a href=\"#taskgroups\" aria-label=\"taskgroups permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TaskGroups</h3>\n<p>Airflow DAG를 짤 때 여러 task를 연결시키다 보면 graph view가 상당히 복잡해지곤 합니다. 이를 해결하기 위해서 airflow에서는 task들을 hierarchical groups으로 정돈할 수 있도록 돕는 TaskGroup이라는 기능을 제공하고 있습니다. 아래의 샘플코드처럼 <code class=\"language-text\">task_group</code> 데커레이터를 통해 간단하게 사용해볼 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token decorator annotation punctuation\">@dag</span><span class=\"token punctuation\">(</span>dag_id<span class=\"token operator\">=</span><span class=\"token string\">\"hello_world\"</span><span class=\"token punctuation\">,</span> start_date<span class=\"token operator\">=</span>datetime<span class=\"token punctuation\">(</span><span class=\"token number\">2023</span><span class=\"token punctuation\">,</span> <span class=\"token number\">12</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> tzinfo<span class=\"token operator\">=</span>pendulum<span class=\"token punctuation\">.</span>timezone<span class=\"token punctuation\">(</span><span class=\"token string\">\"Asia/Seoul\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">hello_world</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    task1 <span class=\"token operator\">=</span> EmptyOperator<span class=\"token punctuation\">(</span>task_id<span class=\"token operator\">=</span><span class=\"token string\">\"task1\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token decorator annotation punctuation\">@task_group</span><span class=\"token punctuation\">(</span>group_id<span class=\"token operator\">=</span><span class=\"token string\">\"task_group1\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">task_group1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        task2 <span class=\"token operator\">=</span> EmptyOperator<span class=\"token punctuation\">(</span>task_id<span class=\"token operator\">=</span><span class=\"token string\">\"task2\"</span><span class=\"token punctuation\">)</span>   \n\n        <span class=\"token decorator annotation punctuation\">@task_group</span><span class=\"token punctuation\">(</span>group_id<span class=\"token operator\">=</span><span class=\"token string\">\"task_group2\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">def</span> <span class=\"token function\">task_group2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            task3 <span class=\"token operator\">=</span> EmptyOperator<span class=\"token punctuation\">(</span>task_id<span class=\"token operator\">=</span><span class=\"token string\">\"task3\"</span><span class=\"token punctuation\">)</span>  \n            task4 <span class=\"token operator\">=</span> EmptyOperator<span class=\"token punctuation\">(</span>task_id<span class=\"token operator\">=</span><span class=\"token string\">\"task4\"</span><span class=\"token punctuation\">)</span> \n            <span class=\"token punctuation\">[</span>task3<span class=\"token punctuation\">,</span> task4<span class=\"token punctuation\">]</span>\n        \n        <span class=\"token punctuation\">[</span>task2 <span class=\"token operator\">>></span> task_group2<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n\n    <span class=\"token punctuation\">[</span>task1 <span class=\"token operator\">>></span> task_group1<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n\ndag <span class=\"token operator\">=</span> hello_world<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Airflow UI에서 해당 task group을 클릭하면 내부 요소들을 열고 닫으며 확인할 수 있습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 760px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e593b4c403da9b14245fe295e12e6232/eafa0/23-12-18-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.26315789473684%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABB0lEQVQoz22Ri26DMAxF+/+/OGmDtnQFki3vpOFxa3tFY2iRLBJjn9xcn9Z1xTF4WecxjAopJeRSkHOR7+PxkCi0L698rZP0cO9pAxyBX8bhc9CIMVBEiRAClNLQWsNaS+FgjBXoH+CyLPjJADPtOccqUkxSLLAX8O39jPbcCUgReFSK/qdfIG+Ms2i6BiF5gU7TDOcjLrcLuuGKOlVp8CHidu/Rdi20UVxKtRPZkndAVjXPSCWTF5XUrqIykneeFLngSWUmxVXO937EtzF0oZca58mSPXDzbFvbmSH8VB7K3sN+GNBcP0Thsi4iIh2B/0158y4KMAk40JMNDcM4J8F5T9bsh/IEjm0g0SvRzPgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/e593b4c403da9b14245fe295e12e6232/15813/23-12-18-1.webp 190w,\n/static/e593b4c403da9b14245fe295e12e6232/1cdb2/23-12-18-1.webp 380w,\n/static/e593b4c403da9b14245fe295e12e6232/9046c/23-12-18-1.webp 760w,\n/static/e593b4c403da9b14245fe295e12e6232/1588c/23-12-18-1.webp 939w\"\n              sizes=\"(max-width: 760px) 100vw, 760px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/e593b4c403da9b14245fe295e12e6232/a2d4f/23-12-18-1.png 190w,\n/static/e593b4c403da9b14245fe295e12e6232/3f520/23-12-18-1.png 380w,\n/static/e593b4c403da9b14245fe295e12e6232/3c051/23-12-18-1.png 760w,\n/static/e593b4c403da9b14245fe295e12e6232/eafa0/23-12-18-1.png 939w\"\n            sizes=\"(max-width: 760px) 100vw, 760px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/e593b4c403da9b14245fe295e12e6232/3c051/23-12-18-1.png\"\n            alt=\"img\"\n            title=\"img\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h3 id=\"dynamic-task-mapping\" style=\"position:relative;\"><a href=\"#dynamic-task-mapping\" aria-label=\"dynamic task mapping permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Dynamic Task Mapping</h3>\n<p>또 다른 유용한 기능으로는 dynamic task mapping이 존재합니다. Task의 수를 사전에 미리 알 필요 없이, runtime에서 주어진 data를 기반으로 동적으로 병렬 task를 생성하고 싶을 때 dynamic task mapping를 사용해볼 수 있습니다. 제 경우에는 ETL 프로세스에서 여러 조건 별 데이터 배치 처리가 필요할 때 dynamic task mapping을 활용하고 있습니다.  </p>\n<p>샘플코드처럼 <code class=\"language-text\">expand()</code> method를 통해 간단하게 사용해볼 수 있습니다. 아래 예시는 airflow 공식 문서의 예제입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token decorator annotation punctuation\">@dag</span><span class=\"token punctuation\">(</span>dag_id<span class=\"token operator\">=</span><span class=\"token string\">\"dynamic_dag\"</span><span class=\"token punctuation\">,</span> start_date<span class=\"token operator\">=</span>datetime<span class=\"token punctuation\">(</span><span class=\"token number\">2023</span><span class=\"token punctuation\">,</span> <span class=\"token number\">12</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> tzinfo<span class=\"token operator\">=</span>pendulum<span class=\"token punctuation\">.</span>timezone<span class=\"token punctuation\">(</span><span class=\"token string\">\"Asia/Seoul\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">dynamic_dag</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token decorator annotation punctuation\">@task</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">add_one</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">:</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> x <span class=\"token operator\">+</span> <span class=\"token number\">1</span>\n\n    <span class=\"token decorator annotation punctuation\">@task</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">sum_it</span><span class=\"token punctuation\">(</span>values<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        total <span class=\"token operator\">=</span> <span class=\"token builtin\">sum</span><span class=\"token punctuation\">(</span>values<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f\"Total was </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>total<span class=\"token punctuation\">}</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span>\n\n    added_values <span class=\"token operator\">=</span> add_one<span class=\"token punctuation\">.</span>expand<span class=\"token punctuation\">(</span>x<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    sum_it<span class=\"token punctuation\">(</span>added_values<span class=\"token punctuation\">)</span>\n\ndag <span class=\"token operator\">=</span> dynamic_dag<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 760px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1dc052de3aa290cb092ccbe5b7000383/c0255/23-12-18-2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 10.526315789473683%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAVUlEQVQI122MSwqAMBBDe/87iriqv26sDq3ziZ2uRAy8RUKSYGZ442JmbGkHEUHVoC0/6cKRc/PaEVF8t074Oyy1YJwG1Hr3sWtNC+YY4RXPWOT38AHPQJ1KLZDbTQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/1dc052de3aa290cb092ccbe5b7000383/15813/23-12-18-2.webp 190w,\n/static/1dc052de3aa290cb092ccbe5b7000383/1cdb2/23-12-18-2.webp 380w,\n/static/1dc052de3aa290cb092ccbe5b7000383/9046c/23-12-18-2.webp 760w,\n/static/1dc052de3aa290cb092ccbe5b7000383/966d8/23-12-18-2.webp 920w\"\n              sizes=\"(max-width: 760px) 100vw, 760px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/1dc052de3aa290cb092ccbe5b7000383/a2d4f/23-12-18-2.png 190w,\n/static/1dc052de3aa290cb092ccbe5b7000383/3f520/23-12-18-2.png 380w,\n/static/1dc052de3aa290cb092ccbe5b7000383/3c051/23-12-18-2.png 760w,\n/static/1dc052de3aa290cb092ccbe5b7000383/c0255/23-12-18-2.png 920w\"\n            sizes=\"(max-width: 760px) 100vw, 760px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/1dc052de3aa290cb092ccbe5b7000383/3c051/23-12-18-2.png\"\n            alt=\"img\"\n            title=\"img\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h3 id=\"dynamic-task-mapping-with-taskgroups\" style=\"position:relative;\"><a href=\"#dynamic-task-mapping-with-taskgroups\" aria-label=\"dynamic task mapping with taskgroups permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Dynamic Task Mapping with TaskGroups</h3>\n<p>동일한 방식으로 task 뿐만 아니라 task group에 대한 dynamic task mapping 또한 가능합니다. </p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">set_mapped_args</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    dummy_mapped_args <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">]</span>\n    Variable<span class=\"token punctuation\">.</span><span class=\"token builtin\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"output_of_start\"</span><span class=\"token punctuation\">,</span> dummy_mapped_args<span class=\"token punctuation\">,</span> serialize_json<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token decorator annotation punctuation\">@dag</span><span class=\"token punctuation\">(</span>\n    dag_id<span class=\"token operator\">=</span><span class=\"token string\">\"dynamic_task_group_dag\"</span><span class=\"token punctuation\">,</span>\n    schedule<span class=\"token operator\">=</span><span class=\"token string\">\"0 0 * * *\"</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># i.e., daily</span>\n    catchup<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span>\n    start_date<span class=\"token operator\">=</span>datetime<span class=\"token punctuation\">(</span><span class=\"token number\">2023</span><span class=\"token punctuation\">,</span> <span class=\"token number\">12</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> tzinfo<span class=\"token operator\">=</span>pendulum<span class=\"token punctuation\">.</span>timezone<span class=\"token punctuation\">(</span><span class=\"token string\">\"Asia/Seoul\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">dynamic_task_group_dag</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    start <span class=\"token operator\">=</span> PythonOperator<span class=\"token punctuation\">(</span>\n        task_id<span class=\"token operator\">=</span><span class=\"token string\">\"start\"</span><span class=\"token punctuation\">,</span>\n        python_callable<span class=\"token operator\">=</span>set_mapped_args<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span>\n\n    <span class=\"token decorator annotation punctuation\">@task_group</span><span class=\"token punctuation\">(</span>group_id<span class=\"token operator\">=</span><span class=\"token string\">\"task_group\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">task_group_node</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        mapped_args <span class=\"token operator\">=</span> Variable<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"output_of_start\"</span><span class=\"token punctuation\">,</span> default_var<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> deserialize_json<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token decorator annotation punctuation\">@task_group</span><span class=\"token punctuation\">(</span>group_id<span class=\"token operator\">=</span><span class=\"token string\">\"dynamic_task_group\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">def</span> <span class=\"token function\">dynamic_task_group_node</span><span class=\"token punctuation\">(</span>mapped_args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            task1 <span class=\"token operator\">=</span> MyCustomOperator<span class=\"token punctuation\">(</span>task_id<span class=\"token operator\">=</span><span class=\"token string\">'task1'</span><span class=\"token punctuation\">,</span> mapped_args<span class=\"token operator\">=</span>mapped_args<span class=\"token punctuation\">)</span>\n            task1\n\n        <span class=\"token keyword\">if</span> mapped_args<span class=\"token punctuation\">:</span>\n            dynamic_task_group_node<span class=\"token punctuation\">.</span>expand<span class=\"token punctuation\">(</span>mapped_args<span class=\"token operator\">=</span>mapped_args<span class=\"token punctuation\">)</span>\n\n    <span class=\"token punctuation\">[</span>start <span class=\"token operator\">>></span> task_group_node<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n\ndag <span class=\"token operator\">=</span> dynamic_task_group_dag<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 760px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/25d8354edbceeef5e3ca2cdddfe39a87/715a3/23-12-18-3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 28.421052631578945%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA1ElEQVQY032Qi2rEIBRE9/8/r5RtWsiGQtrEKMb1kfi6mRppl1KSCoNcGQ9HL9u24Sz7couDEALGWIQQ4X14JMYElNrvO5czGG1UgaNkeGpaSKmwFLi19pF19bVzCMS30V9wShkfbMRz84LbrUPXdej7HpwLWLecA3POCDHWAtE+U00IAUJyXNt3TELCOQetDZS6HwN/nna3Cq9vV0yfQ/mbUIV3O20cGOdo2gbDwArE1n5M6X9DogxrNPQ8IxXTakmE1XvMSoFNHOM41V1rW86ODb8AptXTMQ0FWbgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/25d8354edbceeef5e3ca2cdddfe39a87/15813/23-12-18-3.webp 190w,\n/static/25d8354edbceeef5e3ca2cdddfe39a87/1cdb2/23-12-18-3.webp 380w,\n/static/25d8354edbceeef5e3ca2cdddfe39a87/9046c/23-12-18-3.webp 760w,\n/static/25d8354edbceeef5e3ca2cdddfe39a87/b2a51/23-12-18-3.webp 830w\"\n              sizes=\"(max-width: 760px) 100vw, 760px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/25d8354edbceeef5e3ca2cdddfe39a87/a2d4f/23-12-18-3.png 190w,\n/static/25d8354edbceeef5e3ca2cdddfe39a87/3f520/23-12-18-3.png 380w,\n/static/25d8354edbceeef5e3ca2cdddfe39a87/3c051/23-12-18-3.png 760w,\n/static/25d8354edbceeef5e3ca2cdddfe39a87/715a3/23-12-18-3.png 830w\"\n            sizes=\"(max-width: 760px) 100vw, 760px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/25d8354edbceeef5e3ca2cdddfe39a87/3c051/23-12-18-3.png\"\n            alt=\"img\"\n            title=\"img\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>다만 이때 주의할 점이 있는데, expand를 통해 task group에 전달된 값은 실제로 dag가 수행되기 전까지는 MappedArgument object로 real value가 아닙니다. 해당 task group이 실제로 실행될 때에 비로소 real value를 resolve할 수 있는데, 저의 경우에는 아래처럼 MappedArgument의 resolve method를 활용하여 real value를 runtime에 얻어내는 방식으로 DAG 코드를 작성하였습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> airflow<span class=\"token punctuation\">.</span>models<span class=\"token punctuation\">.</span>baseoperator <span class=\"token keyword\">import</span> BaseOperator\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">MyCustomOperator</span><span class=\"token punctuation\">(</span>BaseOperator<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> mapped_args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kwargs<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">:</span>\n        <span class=\"token builtin\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>__init__<span class=\"token punctuation\">(</span><span class=\"token operator\">**</span>kwargs<span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>mapped_args <span class=\"token operator\">=</span> mapped_args\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">execute</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        self<span class=\"token punctuation\">.</span>cur_value <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>mapped_args<span class=\"token punctuation\">.</span>resolve<span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span></code></pre></div>\n<h3 id=\"reference\" style=\"position:relative;\"><a href=\"#reference\" aria-label=\"reference permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reference</h3>\n<ul>\n<li><a href=\"https://airflow.apache.org/docs/apache-airflow/stable/authoring-and-scheduling/dynamic-task-mapping.html#dynamic-task-mapping\">https://airflow.apache.org/docs/apache-airflow/stable/authoring-and-scheduling/dynamic-task-mapping.html#dynamic-task-mapping</a></li>\n<li><a href=\"https://airflow.apache.org/docs/apache-airflow/stable/authoring-and-scheduling/dynamic-task-mapping.html#dynamic-task-mapping\">https://airflow.apache.org/docs/apache-airflow/stable/authoring-and-scheduling/dynamic-task-mapping.html#dynamic-task-mapping</a></li>\n<li><a href=\"https://airflow.apache.org/docs/apache-airflow/stable/core-concepts/dags.html#taskgroups\">https://airflow.apache.org/docs/apache-airflow/stable/core-concepts/dags.html#taskgroups</a></li>\n</ul>","tableOfContents":"<ul>\n<li><a href=\"/MachineLearning/23-12-18-Dynamic%20Task%20Mapping%20with%20TaskGroups/#taskgroups\">TaskGroups</a></li>\n<li><a href=\"/MachineLearning/23-12-18-Dynamic%20Task%20Mapping%20with%20TaskGroups/#dynamic-task-mapping\">Dynamic Task Mapping</a></li>\n<li><a href=\"/MachineLearning/23-12-18-Dynamic%20Task%20Mapping%20with%20TaskGroups/#dynamic-task-mapping-with-taskgroups\">Dynamic Task Mapping with TaskGroups</a></li>\n<li><a href=\"/MachineLearning/23-12-18-Dynamic%20Task%20Mapping%20with%20TaskGroups/#reference\">Reference</a></li>\n</ul>","frontmatter":{"path":"/Operations/23-12-18/","title":"Dynamic Task Mapping with TaskGroups","category":"Operations","date":"2023-12-18"}}},"pageContext":{}},"staticQueryHashes":["2390655019","256249292","63159454"]}