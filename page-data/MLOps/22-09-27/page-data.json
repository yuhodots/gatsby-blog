{"componentChunkName":"component---src-templates-post-js","path":"/MLOps/22-09-27/","result":{"data":{"markdownRemark":{"html":"<blockquote>\n<p>Apache airflow는 에어비앤비에서 만든 워크플로우 관리 시스템입니다. 본 포스팅에서는 기초적인 airflow DAGs 작성 예시와 사용법을 정리합니다.</p>\n</blockquote>\n<h3 id=\"basics\" style=\"position:relative;\"><a href=\"#basics\" aria-label=\"basics permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Basics</h3>\n<ul>\n<li>DAG: Task의 집합</li>\n<li>Task: Airflow DAGs의 기본 실행 단위</li>\n<li>Operator: Task 구현을 위한 템플릿. 제일 기본적으로는 BashOperator와 PythonOperator가 존재하고, 그 외에 SQL Operator, Http Operator 등 존재</li>\n<li>Sensor: 외부 이벤트에 대해 특정 조건 만족하는지 주기적으로 확인</li>\n<li>XComs (i.e., cross-communications): XComs를 통해 task간 정보 주고받을 수 있음. JSON은 지원하지만 dataframe 같은 용량이 큰 데이터는 지원하지 않음. 따라서 데이터 용량이 큰 경우에는 특정 다른 공간에 저장한 뒤 저장된 위치를 XComs로 전달하는게 일반적인 디자인 패턴</li>\n<li>Task Lifecycle: <code class=\"language-text\">no_status</code> <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>→</mo></mrow><annotation encoding=\"application/x-tex\">\\to</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.36687em;vertical-align:0em;\"></span><span class=\"mrel\">→</span></span></span></span> Scheduler  <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>→</mo></mrow><annotation encoding=\"application/x-tex\">\\to</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.36687em;vertical-align:0em;\"></span><span class=\"mrel\">→</span></span></span></span> <code class=\"language-text\">{status}</code>  <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>→</mo></mrow><annotation encoding=\"application/x-tex\">\\to</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.36687em;vertical-align:0em;\"></span><span class=\"mrel\">→</span></span></span></span> Executor  <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>→</mo></mrow><annotation encoding=\"application/x-tex\">\\to</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.36687em;vertical-align:0em;\"></span><span class=\"mrel\">→</span></span></span></span> <code class=\"language-text\">{status}</code>  <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>→</mo></mrow><annotation encoding=\"application/x-tex\">\\to</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.36687em;vertical-align:0em;\"></span><span class=\"mrel\">→</span></span></span></span> Worker  <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>→</mo></mrow><annotation encoding=\"application/x-tex\">\\to</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.36687em;vertical-align:0em;\"></span><span class=\"mrel\">→</span></span></span></span> <code class=\"language-text\">{status}</code></li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 760px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cc31f9ee5089f6eebb4be1e844d8160d/bf8c1/23-09-23-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 4.2105263157894735%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAABYlAAAWJQFJUiTwAAAATUlEQVQI1wXB4QpAMBSAUe//ctQIKWUsLne7a5a/n3OaNE/sIRCjYtEoviAidF/HpRsmB+OY6V0lrxH1B61vWdLJmo1JH+53pybHZwM/qqZJw6cxolwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/cc31f9ee5089f6eebb4be1e844d8160d/15813/23-09-23-1.webp 190w,\n/static/cc31f9ee5089f6eebb4be1e844d8160d/1cdb2/23-09-23-1.webp 380w,\n/static/cc31f9ee5089f6eebb4be1e844d8160d/9046c/23-09-23-1.webp 760w,\n/static/cc31f9ee5089f6eebb4be1e844d8160d/c89f9/23-09-23-1.webp 1140w,\n/static/cc31f9ee5089f6eebb4be1e844d8160d/7afe4/23-09-23-1.webp 1520w,\n/static/cc31f9ee5089f6eebb4be1e844d8160d/77d2c/23-09-23-1.webp 1722w\"\n              sizes=\"(max-width: 760px) 100vw, 760px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/cc31f9ee5089f6eebb4be1e844d8160d/a2d4f/23-09-23-1.png 190w,\n/static/cc31f9ee5089f6eebb4be1e844d8160d/3f520/23-09-23-1.png 380w,\n/static/cc31f9ee5089f6eebb4be1e844d8160d/3c051/23-09-23-1.png 760w,\n/static/cc31f9ee5089f6eebb4be1e844d8160d/b5cea/23-09-23-1.png 1140w,\n/static/cc31f9ee5089f6eebb4be1e844d8160d/891d5/23-09-23-1.png 1520w,\n/static/cc31f9ee5089f6eebb4be1e844d8160d/bf8c1/23-09-23-1.png 1722w\"\n            sizes=\"(max-width: 760px) 100vw, 760px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/cc31f9ee5089f6eebb4be1e844d8160d/3c051/23-09-23-1.png\"\n            alt=\"img\"\n            title=\"img\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h3 id=\"installation\" style=\"position:relative;\"><a href=\"#installation\" aria-label=\"installation permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Installation</h3>\n<p>로컬 가상환경에서 pip를 통해 airflow를 설치하여 사용하거나, airflow docker 이미지를 pull 받아 사용하는 방법이 존재합니다. 이 중 docker를 활용하는 방식을 권장드립니다.</p>\n<h5 id=\"airflow-w-pip-install\" style=\"position:relative;\"><a href=\"#airflow-w-pip-install\" aria-label=\"airflow w pip install permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Airflow w. PIP Install</h5>\n<ol>\n<li><a href=\"https://github.com/apache/airflow\">공식 저장소</a>에서 airflow 버전 및 다운 방법을 확인하여 다운 받습니다.</li>\n<li><code class=\"language-text\">export AIRFLOW_HOME=.</code> 환경 변수 설정을 합니다.</li>\n<li>Airflow DB, 웹 서버, 스케줄러를 각각 실행합니다:   <code class=\"language-text\">airflow db init</code>, <code class=\"language-text\">airflow webserver -p 8080</code>, <code class=\"language-text\">airflow scheduler</code></li>\n<li><code class=\"language-text\">airflow users create --help</code> 명령어를 통해 유저 설정 방법을 확인하고, username, password를 설정합니다. </li>\n<li>localhost:8080/ 에 접속하여 웹서버가 잘 작동하는지 확인합니다.</li>\n</ol>\n<h5 id=\"airflow-w-docker\" style=\"position:relative;\"><a href=\"#airflow-w-docker\" aria-label=\"airflow w docker permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Airflow w. Docker</h5>\n<ol>\n<li>다음 명령을 통해 compose file을 다운받습니다: <code class=\"language-text\">curl -Lf0 &#39;https://airflow.apache.org/docs/apache-airflow/2.0.1/docker-compose.yaml&quot;</code></li>\n<li><code class=\"language-text\">mkdir ./dags ./logs ./plugins</code> 명령을 통해 기본 디렉토리들을 생성합니다.</li>\n<li>초기화 및 compose 파일 실행을 순서대로 진행합니다: <code class=\"language-text\">docker-compose up airflow-init</code>, <code class=\"language-text\">docker-compose up -d</code></li>\n<li>localhost:8080/ 에 접속하여 웹서버가 잘 작동하는지 확인합니다.</li>\n<li>webserver 컨테이너에서 <code class=\"language-text\">airflow users create --help</code> 명령어를 통해 유저를 생성할 수 있습니다. (기본 유저는 name:airflow, passwd: airflow)</li>\n</ol>\n<h3 id=\"dags\" style=\"position:relative;\"><a href=\"#dags\" aria-label=\"dags permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DAGs</h3>\n<p><code class=\"language-text\">docker-compose.yaml</code> 파일에서 <code class=\"language-text\">AIRFLOW__CORE__LOAD_EXAMPLES</code> 옵션을 true로 설정하면 다양한 DAG 예시를 확인하실 수 있습니다.</p>\n<h5 id=\"example-code-hello-world\" style=\"position:relative;\"><a href=\"#example-code-hello-world\" aria-label=\"example code hello world permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Example Code: Hello World!</h5>\n<p><a href=\"https://github.com/yuhodots/airflow/blob/main/dags/greet_python.py\">이 곳</a>에서도 간단한 예시 코드를 확인 가능합니다.</p>\n<ul>\n<li><code class=\"language-text\">start_date</code>: 시작되는 기준 시점. 즉, 실제 실행은 'start_date + 주기'부터 시작</li>\n<li><code class=\"language-text\">execution_date</code>: 실제 실행 날짜가 아닌 예약을 시도한 시간 (historical name for what is called a <em>logical date</em>)</li>\n<li><code class=\"language-text\">catchup</code>: current date과 start date에 차이가 있어 과거 데이터에 대해서도 DAG가 실행 되어야하는 경우 활용. False로 지정시에는 최근 DAG만 실행</li>\n<li><code class=\"language-text\">backfill</code>: 스케줄 시점이 지나간 DAG 실행할 때 활용</li>\n<li><code class=\"language-text\">retries</code>:  task가 실패했을 때 재실행을 시도</li>\n<li><code class=\"language-text\">retry_delay</code>: 재시도 전에 wait할 시간</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> datetime <span class=\"token keyword\">import</span> datetime\n<span class=\"token keyword\">from</span> airflow <span class=\"token keyword\">import</span> DAG\n<span class=\"token keyword\">from</span> airflow<span class=\"token punctuation\">.</span>operators<span class=\"token punctuation\">.</span>bash <span class=\"token keyword\">import</span> BashOperator\n\ndefault_args <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token string\">'owner'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'yuhodots'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'retries'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'retry_delay'</span><span class=\"token punctuation\">:</span> timedelta<span class=\"token punctuation\">(</span>minutes<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">with</span> DAG<span class=\"token punctuation\">(</span>\n\tdag_id<span class=\"token operator\">=</span><span class=\"token string\">'first_dag'</span><span class=\"token punctuation\">,</span>\n  default_args<span class=\"token operator\">=</span>default_args<span class=\"token punctuation\">,</span>\n  description<span class=\"token operator\">=</span><span class=\"token string\">'first dag'</span>\n  start_date<span class=\"token operator\">=</span>datetime<span class=\"token punctuation\">(</span><span class=\"token number\">2023</span><span class=\"token punctuation\">,</span> <span class=\"token number\">9</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  schedule_interval<span class=\"token operator\">=</span><span class=\"token string\">'@daily'</span>\n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> dag<span class=\"token punctuation\">:</span>\n  \n  task1 <span class=\"token operator\">=</span> BashOperator<span class=\"token punctuation\">(</span>\n  \ttask_id<span class=\"token operator\">=</span><span class=\"token string\">'first_task'</span><span class=\"token punctuation\">,</span>\n    bash_command<span class=\"token operator\">=</span><span class=\"token string\">\"echo hello world, this is the first task!\"</span>\n  <span class=\"token punctuation\">)</span>\n  task2 <span class=\"token operator\">=</span> BashOperator<span class=\"token punctuation\">(</span>\n  \ttask_id<span class=\"token operator\">=</span><span class=\"token string\">'second_task'</span><span class=\"token punctuation\">,</span>\n    bash_command<span class=\"token operator\">=</span><span class=\"token string\">\"echo hello world, this is the second task!\"</span>\n  <span class=\"token punctuation\">)</span>\n  task1 <span class=\"token operator\">>></span> task2\t<span class=\"token comment\"># same with `task1.set_downstream(task2)`</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> datetime <span class=\"token keyword\">import</span> datetime\n<span class=\"token keyword\">from</span> airflow <span class=\"token keyword\">import</span> DAG\n<span class=\"token keyword\">from</span> airflow<span class=\"token punctuation\">.</span>operators<span class=\"token punctuation\">.</span>python <span class=\"token keyword\">import</span> PythonOperator\n\ndefault_args <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token string\">'owner'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'yuhodots'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'retries'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'retry_delay'</span><span class=\"token punctuation\">:</span> timedelta<span class=\"token punctuation\">(</span>minutes<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">greet</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> age<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f\"Hello world! My name is </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>name<span class=\"token punctuation\">}</span></span><span class=\"token string\"> and </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>age<span class=\"token punctuation\">}</span></span><span class=\"token string\"> years old\"</span></span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">with</span> DAG<span class=\"token punctuation\">(</span>\n\tdag_id<span class=\"token operator\">=</span><span class=\"token string\">'first_dag'</span><span class=\"token punctuation\">,</span>\n  default_args<span class=\"token operator\">=</span>default_args<span class=\"token punctuation\">,</span>\n  description<span class=\"token operator\">=</span><span class=\"token string\">'first dag'</span>\n  start_date<span class=\"token operator\">=</span>datetime<span class=\"token punctuation\">(</span><span class=\"token number\">2023</span><span class=\"token punctuation\">,</span> <span class=\"token number\">9</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  schedule_interval<span class=\"token operator\">=</span><span class=\"token string\">'@daily'</span>\n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> dag<span class=\"token punctuation\">:</span>\n  \n  task1 <span class=\"token operator\">=</span> PythonOperator<span class=\"token punctuation\">(</span>\n  \ttask_id<span class=\"token operator\">=</span><span class=\"token string\">'first_task'</span><span class=\"token punctuation\">,</span>\n    python_callable<span class=\"token operator\">=</span>greet<span class=\"token punctuation\">,</span>\n    op_kwargs<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'Yuho Jeong'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'age'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">27</span><span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">)</span>\n\n  task1</code></pre></div>\n<p><code class=\"language-text\">with DAG (...) as dag:</code> 대신에 아래와 같은 형태도 가능합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> airflow<span class=\"token punctuation\">.</span>decorators <span class=\"token keyword\">import</span> dag\n<span class=\"token keyword\">from</span> airflow<span class=\"token punctuation\">.</span>operators<span class=\"token punctuation\">.</span>python <span class=\"token keyword\">import</span> PythonOperator\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">greet</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> age<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f\"Hello world! My name is </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>name<span class=\"token punctuation\">}</span></span><span class=\"token string\"> and </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>age<span class=\"token punctuation\">}</span></span><span class=\"token string\"> years old\"</span></span><span class=\"token punctuation\">)</span>\n\n<span class=\"token decorator annotation punctuation\">@dag</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">greet_dag</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    task1 <span class=\"token operator\">=</span> PythonOperator<span class=\"token punctuation\">(</span>\n  \t\ttask_id<span class=\"token operator\">=</span><span class=\"token string\">'first_task'</span><span class=\"token punctuation\">,</span>\n    \tpython_callable<span class=\"token operator\">=</span>greet<span class=\"token punctuation\">,</span>\n    \top_kwargs<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'Yuho Jeong'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'age'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">27</span><span class=\"token punctuation\">}</span>\n  \t<span class=\"token punctuation\">)</span>\n    task1\n    \ndag <span class=\"token operator\">=</span> greet_dag<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h5 id=\"connection\" style=\"position:relative;\"><a href=\"#connection\" aria-label=\"connection permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Connection</h5>\n<p>Webserver의 Admin 탭에서 connection 설정을 할 수 있습니다. Connection은 외부 연결을 관리해주며, 일반적으로 클라우드에 존재하는 DB 서버, Datalake 등의 연결을 목적으로 활용됩니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 760px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5f55166efd0c11ff0e32b6277c6e5613/799f3/23-09-23-2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.05263157894737%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA70lEQVQY041R2U7DMBDM//8MT/xAfwAJoaIqoVJTEtm5fDuXk8FrWh5AAiyNZtfanb2yM+9xeHtFmGds2watNaZpghACUkosy5Js4rtvjEkxjDFUVQUTc8ZxBL2MCYW8uoLVNZqmSWjbFpzzhK7rfjDFELd9j5pxzGv4LDwMyIb4WeQF8jxHWZZfCSRKuNvfmWBYjb44QV8v2ON0VDDbwgorOJSSmOPY3vvU/m/wNxaXM8rnJ/j3KBgCrHOxQ7vg8WiiQ0LTDeOfoB1q6yCUTrvb9h2OBDu74uHFQxkH58ckSMH/gYpHkvFgSTCOTIIfkc3KKP/iEFgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/5f55166efd0c11ff0e32b6277c6e5613/15813/23-09-23-2.webp 190w,\n/static/5f55166efd0c11ff0e32b6277c6e5613/1cdb2/23-09-23-2.webp 380w,\n/static/5f55166efd0c11ff0e32b6277c6e5613/9046c/23-09-23-2.webp 760w,\n/static/5f55166efd0c11ff0e32b6277c6e5613/c89f9/23-09-23-2.webp 1140w,\n/static/5f55166efd0c11ff0e32b6277c6e5613/7afe4/23-09-23-2.webp 1520w,\n/static/5f55166efd0c11ff0e32b6277c6e5613/ee7fd/23-09-23-2.webp 1642w\"\n              sizes=\"(max-width: 760px) 100vw, 760px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/5f55166efd0c11ff0e32b6277c6e5613/a2d4f/23-09-23-2.png 190w,\n/static/5f55166efd0c11ff0e32b6277c6e5613/3f520/23-09-23-2.png 380w,\n/static/5f55166efd0c11ff0e32b6277c6e5613/3c051/23-09-23-2.png 760w,\n/static/5f55166efd0c11ff0e32b6277c6e5613/b5cea/23-09-23-2.png 1140w,\n/static/5f55166efd0c11ff0e32b6277c6e5613/891d5/23-09-23-2.png 1520w,\n/static/5f55166efd0c11ff0e32b6277c6e5613/799f3/23-09-23-2.png 1642w\"\n            sizes=\"(max-width: 760px) 100vw, 760px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/5f55166efd0c11ff0e32b6277c6e5613/3c051/23-09-23-2.png\"\n            alt=\"img\"\n            title=\"img\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h5 id=\"graph-view--log\" style=\"position:relative;\"><a href=\"#graph-view--log\" aria-label=\"graph view  log permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Graph View &#x26; Log</h5>\n<p>DAG 구조를 graph view를 통해 한 눈에 확인이 가능하고, 각 노드의 실행 결과는 각 노드를 클릭하면 나오는 log 내에서 확인이 가능합니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 760px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/70c80b6c29366019d4c1e3dd1ac7631e/59f0d/23-09-23-4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.05263157894737%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABJ0lEQVQY04VQy2rDMBD0/39SodBDAy00pybYdVrHUmwlfulhS5bjJJ5KKpTmVMEwLLuamd3IzAukUHh6XOEj/sICYL5ccb0tWByMVBhUDzudMc+X0LuE/g3LstzhPE2IxnFEXTVYrd4QxztI95lzAe6EtFKodztcjcaetdDjhP9eJAVHr2QovIt1BtZaGK1xKBkyQtF1HZqmCcw5h3JGfd9DSgnt5vz84LgfBkReoBMtSJGirCiE4qE+nU5h+NMlTJIEaZoiyzIQQnA8HlGWZeC6roOJNxNCuJWNBWF7vKwfsN4+4z1+xSZZo+lajMZgu9kEwTzPURQFGGMhbdu2v7gTtHZynyvkhxSUZWhE4+7HoYefVSilIRWlJIj9TeUF/NqePfwpvgGTXcUcvWi6WQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/70c80b6c29366019d4c1e3dd1ac7631e/15813/23-09-23-4.webp 190w,\n/static/70c80b6c29366019d4c1e3dd1ac7631e/1cdb2/23-09-23-4.webp 380w,\n/static/70c80b6c29366019d4c1e3dd1ac7631e/9046c/23-09-23-4.webp 760w,\n/static/70c80b6c29366019d4c1e3dd1ac7631e/c89f9/23-09-23-4.webp 1140w,\n/static/70c80b6c29366019d4c1e3dd1ac7631e/7afe4/23-09-23-4.webp 1520w,\n/static/70c80b6c29366019d4c1e3dd1ac7631e/a3f95/23-09-23-4.webp 2370w\"\n              sizes=\"(max-width: 760px) 100vw, 760px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/70c80b6c29366019d4c1e3dd1ac7631e/a2d4f/23-09-23-4.png 190w,\n/static/70c80b6c29366019d4c1e3dd1ac7631e/3f520/23-09-23-4.png 380w,\n/static/70c80b6c29366019d4c1e3dd1ac7631e/3c051/23-09-23-4.png 760w,\n/static/70c80b6c29366019d4c1e3dd1ac7631e/b5cea/23-09-23-4.png 1140w,\n/static/70c80b6c29366019d4c1e3dd1ac7631e/891d5/23-09-23-4.png 1520w,\n/static/70c80b6c29366019d4c1e3dd1ac7631e/59f0d/23-09-23-4.png 2370w\"\n            sizes=\"(max-width: 760px) 100vw, 760px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/70c80b6c29366019d4c1e3dd1ac7631e/3c051/23-09-23-4.png\"\n            alt=\"img\"\n            title=\"img\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h3 id=\"debugging\" style=\"position:relative;\"><a href=\"#debugging\" aria-label=\"debugging permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Debugging</h3>\n<p>DAG 스크립트 파일의 가장 아래에 해당 코드를 추가해줍시다. 그러면 vscode 같은 IDE에서 디버깅이 가능합니다! (with <code class=\"language-text\">.vscode/launch.json</code>)</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># with DAG(...) as dag:</span>\n\n<span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">\"__main__\"</span><span class=\"token punctuation\">:</span>\n    dag<span class=\"token punctuation\">.</span>test<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3 id=\"references\" style=\"position:relative;\"><a href=\"#references\" aria-label=\"references permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>References</h3>\n<p>아래의 자료들을 같이 참고하면 좋습니다.</p>\n<ul>\n<li>Apache Airflow DAGs: <a href=\"https://airflow.apache.org/docs/apache-airflow/stable/core-concepts/dags.html\">https://airflow.apache.org/docs/apache-airflow/stable/core-concepts/dags.html</a></li>\n<li>Airflow Tutorial for Beginners - Full Course in 2 Hours 2022: <a href=\"https://www.youtube.com/watch?v=K9AnJ9_ZAXE&#x26;t=37s\">https://www.youtube.com/watch?v=K9AnJ9_ZAXE&#x26;t=37s</a></li>\n<li>Google Gloud DAG documents: <a href=\"https://cloud.google.com/composer/docs/how-to/using/writing-dags?hl=ko\">https://cloud.google.com/composer/docs/how-to/using/writing-dags?hl=ko</a></li>\n</ul>","tableOfContents":"<ul>\n<li><a href=\"/MachineLearning/23-09-27-Apache%20Airflow%20DAGs/#basics\">Basics</a></li>\n<li>\n<p><a href=\"/MachineLearning/23-09-27-Apache%20Airflow%20DAGs/#installation\">Installation</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"/MachineLearning/23-09-27-Apache%20Airflow%20DAGs/#airflow-w-pip-install\">Airflow w. PIP Install</a></li>\n<li><a href=\"/MachineLearning/23-09-27-Apache%20Airflow%20DAGs/#airflow-w-docker\">Airflow w. Docker</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"/MachineLearning/23-09-27-Apache%20Airflow%20DAGs/#dags\">DAGs</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"/MachineLearning/23-09-27-Apache%20Airflow%20DAGs/#example-code-hello-world\">Example Code: Hello World!</a></li>\n<li><a href=\"/MachineLearning/23-09-27-Apache%20Airflow%20DAGs/#connection\">Connection</a></li>\n<li><a href=\"/MachineLearning/23-09-27-Apache%20Airflow%20DAGs/#graph-view--log\">Graph View &#x26; Log</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"/MachineLearning/23-09-27-Apache%20Airflow%20DAGs/#debugging\">Debugging</a></li>\n<li><a href=\"/MachineLearning/23-09-27-Apache%20Airflow%20DAGs/#references\">References</a></li>\n</ul>","frontmatter":{"path":"/MLOps/22-09-27/","title":"Apache Airflow DAGs","category":"MLOps","date":"2023-09-27"}}},"pageContext":{}},"staticQueryHashes":["2390655019","256249292","63159454"]}